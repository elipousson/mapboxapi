<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mapping with mapboxapi • mapboxapi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mapping with mapboxapi">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mapboxapi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/creating-tiles.html">Creating and uploading Mapbox vector tilesets</a></li>
    <li><a class="dropdown-item" href="../articles/dynamic-maps.html">Dynamic web maps with Mapbox Tiling Service and mapgl</a></li>
    <li><a class="dropdown-item" href="../articles/geocoding.html">Geocoding with Mapbox in mapboxapi</a></li>
    <li><a class="dropdown-item" href="../articles/mapping.html">Mapping with mapboxapi</a></li>
    <li><a class="dropdown-item" href="../articles/navigation.html">Using Mapbox navigation services with mapboxapi</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/walkerke/mapboxapi" aria-label="GitHub"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="mapping_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="mapping_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="mapping_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="mapping_files/leaflet-1.3.1/leaflet.js"></script><link href="mapping_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="mapping_files/proj4-2.6.2/proj4.min.js"></script><script src="mapping_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="mapping_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="mapping_files/leaflet-binding-2.2.2/leaflet.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Mapping with mapboxapi</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/walkerke/mapboxapi/blob/HEAD/vignettes/mapping.Rmd" class="external-link"><code>vignettes/mapping.Rmd</code></a></small>
      <div class="d-none name"><code>mapping.Rmd</code></div>
    </div>

    
    
<p>While <strong>mapboxapi</strong> is not an interface to <a href="https://docs.mapbox.com/mapbox-gl-js/api/" class="external-link">Mapbox GL JS</a>, the
Mapbox JavaScript library for web mapping, it does have functionality
for map-making and visualization in combination with your spatial
analysis workflows.</p>
<div class="section level2">
<h2 id="interactive-and-static-mapping-with-mapbox-styles">Interactive and static mapping with Mapbox styles<a class="anchor" aria-label="anchor" href="#interactive-and-static-mapping-with-mapbox-styles"></a>
</h2>
<p>Let’s say that you’ve designed a custom map style in Mapbox Studio
that you’d like to incorporate into your R projects. In this example,
I’ll use Mapbox’s <a href="https://apps.mapbox.com/cartogram/" class="external-link">Cartogram
tool</a> to generate a custom map style from the R logo.</p>
<p><img src="img/cartogram.png" style="width: 800px"></p>
<p>I can retrieve the style ID from my Mapbox account, or use the
<code><a href="../reference/get_style.html">list_styles()</a></code> function in <strong>mapboxapi</strong> to get
the ID. With the style ID and my Mapbox username, the
<code><a href="../reference/addMapboxTiles.html">addMapboxTiles()</a></code> function allows for direct incorporation
of this style in an R Leaflet project.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/mapboxapi" class="external-link">mapboxapi</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addMapboxTiles.html">addMapboxTiles</a></span><span class="op">(</span>style_id <span class="op">=</span> <span class="st">"ckb83x2ur02oa1hpiq9zdt1i2"</span>,</span>
<span>                 username <span class="op">=</span> <span class="st">"kwalkertcu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-methods.html" class="external-link">setView</a></span><span class="op">(</span>lng <span class="op">=</span> <span class="op">-</span><span class="fl">74.0051</span>,</span>
<span>          lat <span class="op">=</span> <span class="fl">40.7251</span>,</span>
<span>          zoom <span class="op">=</span> <span class="fl">13</span><span class="op">)</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://api.mapbox.com/styles/v1/kwalkertcu/ckb83x2ur02oa1hpiq9zdt1i2/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoia3dhbGtlcnRjdSIsImEiOiJMRk9JSmRvIn0.l1y2jHZ6IARHM_rA1-X45A",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://www.mapbox.com/about/maps/\">Mapbox<\/a> &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap<\/a> <strong><a href=\"https://www.mapbox.com/map-feedback/\" target=\"_blank\">Improve this map<\/a><\/strong>"}]}],"setView":[[40.7251,-74.0051],13,[]]},"evals":[],"jsHooks":[]}</script><p>In some cases, you may be more interested in a static map rather than
an interactive one. Static maps can be created with
<strong>mapboxapi</strong> in two ways. Static maps can be generated
directly in <strong>mapboxapi</strong> with the
<code><a href="../reference/static_mapbox.html">static_mapbox()</a></code> function. This function accepts sf
polygon/linestring (of limited size) or marker overlays.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points_of_interest</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">73.99405</span>, <span class="op">-</span><span class="fl">74.00616</span>, <span class="op">-</span><span class="fl">73.99577</span>, <span class="op">-</span><span class="fl">74.00761</span><span class="op">)</span>,</span>
<span>  latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40.72033</span>, <span class="fl">40.72182</span>, <span class="fl">40.71590</span>, <span class="fl">40.71428</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_overlay_markers.html">prep_overlay_markers</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">points_of_interest</span>,</span>
<span>  marker_type <span class="op">=</span> <span class="st">"pin-l"</span>,</span>
<span>  label <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  color <span class="op">=</span> <span class="st">"#fff"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/static_mapbox.html">static_mapbox</a></span><span class="op">(</span></span>
<span>  style_id <span class="op">=</span> <span class="st">"ckb83x2ur02oa1hpiq9zdt1i2"</span>,</span>
<span>  username <span class="op">=</span> <span class="st">"kwalkertcu"</span>,</span>
<span>  overlay_markers <span class="op">=</span> <span class="va">prepped_pois</span>, </span>
<span>  width <span class="op">=</span> <span class="fl">1200</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">800</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span></span></code></pre></div>
<p><img src="img/static1.png" width="600"></p>
<p>The output is an object from the <a href="https://github.com/ropensci/magick" class="external-link">magick</a> R package that can
be further customized with <strong>magick</strong> functions.</p>
<p>Alternatively, users might be interested in retrieving static tiles
for use as a basemap in tmap or ggplot2 maps. For an input sf object,
the <code><a href="../reference/get_static_tiles.html">get_static_tiles()</a></code> function will retrieve static tiles
as a raster object around the input. The example below fetches the
standard Light Mapbox basemap and uses it as a basemap for demographic
data obtained with tidycensus.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/" class="external-link">tidycensus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">travis_income</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">get_acs</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"tract"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"B19013_001"</span>,</span>
<span>  state <span class="op">=</span> <span class="st">"TX"</span>,</span>
<span>  county <span class="op">=</span> <span class="st">"Travis"</span>,</span>
<span>  geometry <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2019</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">travis_tiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_static_tiles.html">get_static_tiles</a></span><span class="op">(</span></span>
<span>  location <span class="op">=</span> <span class="va">travis_income</span>,</span>
<span>  zoom <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  style_id <span class="op">=</span> <span class="st">"light-v9"</span>,</span>
<span>  username <span class="op">=</span> <span class="st">"mapbox"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">travis_tiles</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_rgb</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">travis_income</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"estimate"</span>,  </span>
<span>              alpha <span class="op">=</span> <span class="fl">0.5</span>, palette <span class="op">=</span> <span class="st">"cividis"</span>, </span>
<span>              title <span class="op">=</span> <span class="st">"Median household income\n2015-2019 ACS"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_credits.html" class="external-link">tm_credits</a></span><span class="op">(</span><span class="st">"Basemap © Mapbox, © OpenStreetMap"</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mapping_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="reading-vector-tile-data-into-r">Reading vector tile data into R<a class="anchor" aria-label="anchor" href="#reading-vector-tile-data-into-r"></a>
</h2>
<p>Mapbox styles on interactive maps are generally delivered as vector
tiles, and can be visualized in this way in R with the <a href="https://symbolixau.github.io/mapdeck/articles/mapdeck.html" class="external-link">mapdeck
R package</a> by providing style information obtained from Mapbox
Studio. <strong>mapboxapi</strong> also allows you to read data from
vector tilesets directly into R as sf objects.</p>
<p>For example, let’s say I want to grab data from a vector tileset
nearby to one of the points of interest I just mapped. This can be
accomplished with the <code><a href="../reference/get_vector_tiles.html">get_vector_tiles()</a></code> function and an
appropriate tileset ID, which can be obtained from your Mapbox account.
The location to query can be a coordinate pair, an address, or an sf
object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vector_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_vector_tiles.html">get_vector_tiles</a></span><span class="op">(</span></span>
<span>  tileset_id <span class="op">=</span> <span class="st">"mapbox.mapbox-streets-v8"</span>,</span>
<span>  location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">73.99405</span>, <span class="fl">40.72033</span><span class="op">)</span>,</span>
<span>  zoom <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vector_extract</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "building"           "landuse"            "place_label"       </span></span>
<span><span class="co">## [4] "poi_label"          "road"               "structure"         </span></span>
<span><span class="co">## [7] "transit_stop_label" "water"</span></span></code></pre>
<p>I get back a number of layers, including roads, labels, and
buildings, from the vector tile at zoom 15 that intersects my input
coordinates. All of these elements are processed as sf objects that can
be mapped with R tools:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">vector_extract</span><span class="op">$</span><span class="va">building</span><span class="op">$</span><span class="va">polygons</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="mapping_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://walker-data.com" class="external-link">Kyle Walker</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
