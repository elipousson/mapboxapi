<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dynamic web maps with Mapbox Tiling Service and mapgl • mapboxapi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dynamic web maps with Mapbox Tiling Service and mapgl">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mapboxapi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/creating-tiles.html">Creating and uploading Mapbox vector tilesets</a></li>
    <li><a class="dropdown-item" href="../articles/dynamic-maps.html">Dynamic web maps with Mapbox Tiling Service and mapgl</a></li>
    <li><a class="dropdown-item" href="../articles/geocoding.html">Geocoding with Mapbox in mapboxapi</a></li>
    <li><a class="dropdown-item" href="../articles/mapping.html">Mapping with mapboxapi</a></li>
    <li><a class="dropdown-item" href="../articles/navigation.html">Using Mapbox navigation services with mapboxapi</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/walkerke/mapboxapi" aria-label="GitHub"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="dynamic-maps_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="https://api.mapbox.com/mapbox-gl-js/v3.6.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.6.0/mapbox-gl.js"></script><link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js"></script><script src="dynamic-maps_files/freehand-mode-1.0.0/freehand-mode.js"></script><link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script><script src="dynamic-maps_files/mapboxgl-binding-0.1.4/mapboxgl.js"></script><link href="dynamic-maps_files/layers-control-1.0.0/layers-control.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Dynamic web maps with Mapbox Tiling Service and mapgl</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/walkerke/mapboxapi/blob/HEAD/vignettes/dynamic-maps.Rmd" class="external-link"><code>vignettes/dynamic-maps.Rmd</code></a></small>
      <div class="d-none name"><code>dynamic-maps.Rmd</code></div>
    </div>

    
    
<p><strong>mapboxapi</strong> version 0.5 added support for the <a href="https://docs.mapbox.com/api/maps/mapbox-tiling-service/" class="external-link">Mapbox
Tiling Service (MTS) API</a>, Mapbox’s recommended tool for publishing
and maintaining vector tile data pipelines. A major benefit to using R
and <strong>mapboxapi</strong> to interact with MTS is that data
pipelines for web maps can be handled directly from R. This vignette
covers an example walkthrough of how to build dynamic web maps with
vector tiles using Mapbox Tiling Service and the <a href="https://walker-data.com/mapgl/" class="external-link">mapgl R package</a>, a flexible R
interface to Mapbox GL JS.</p>
<div class=".warning">
<p><strong>Warning:</strong> Using MTS is <em>not</em> free, and large
tileset processing jobs (like this one) that cover a large extent can
incur significant charges to your Mapbox account. Please use with
caution.</p>
</div>
<p>We’ll be making a map of household access to a broadband internet
subscription from the 2016-2020 American Community Survey that varies by
zoom level. The map should show county broadband internet access when
zoomed out, and Census tract level information when zoomed in. We will
accomplish this by preparing a <em>multi-layer tileset</em> that will
store information for both aggregation levels.</p>
<p>To get started, let’s grab some data from the US Census Bureau using
<a href="https://walker-data.com/tidycensus/" class="external-link">tidycensus</a>. This
example assumes you have a Census API key; <a href="https://walker-data.com/tidycensus/articles/basic-usage.html" class="external-link">review
the tidycensus documentation to get set up if you don’t</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/" class="external-link">tidycensus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/mapboxapi" class="external-link">mapboxapi</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">county_broadband</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">get_acs</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"DP02_0154P"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  geometry <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tract_broadband</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">get_acs</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"tract"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"DP02_0154P"</span>,</span>
<span>  state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">state.abb</span>, <span class="st">"DC"</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  geometry <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="publishing-vector-tiles-from-r-with-mapbox-tiling-service">Publishing vector tiles from R with Mapbox Tiling Service<a class="anchor" aria-label="anchor" href="#publishing-vector-tiles-from-r-with-mapbox-tiling-service"></a>
</h2>
<p>Spatial data prepared in R can be published to a user’s Mapbox
account with just a few steps. These steps involve creating <em>tileset
sources</em>, which are datasets stored as raw GeoJSON in a user’s
account; preparing a <em>tileset recipe</em>, which tells Mapbox how to
create vector tiles from the GeoJSON sources; then creating and
publishing <em>vector tilesets</em>. These vector tilesets can be
integrated directly into maps with Mapbox GL JS / the mapboxer R
package, or added to Mapbox styles using Mapbox Studio.</p>
<p>To create tileset sources directly from R, we using the function
<code><a href="../reference/mts_create_source.html">mts_create_source()</a></code>. We’ll create a source for each dataset
that we want to include in our tileset. Assigning the results of
<code><a href="../reference/mts_create_source.html">mts_create_source()</a></code> to an object allows us to capture the
function’s list output, which will be useful when building the tileset
recipe.</p>
<p><code><a href="../reference/mts_create_source.html">mts_create_source()</a></code> requires a Mapbox access token with
secret scope and write access to your Mapbox account. <a href="https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes" class="external-link">Visit
the Mapbox website</a> for more information about access tokens, and
store yours using the <code><a href="../reference/mb_access_token.html">mb_access_token()</a></code> function. You’ll
also supply your own username to the <code>username</code> argument,
rather than use mine. Large datasets can take a few minutes to upload to
your account depending on your connection speed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">county_source</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mts_create_source.html">mts_create_source</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">county_broadband</span>,</span>
<span>  tileset_id <span class="op">=</span> <span class="st">"county_broadband"</span>,</span>
<span>  username <span class="op">=</span> <span class="st">"kwalkertcu"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tract_source</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mts_create_source.html">mts_create_source</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">tract_broadband</span>,</span>
<span>  tileset_id <span class="op">=</span> <span class="st">"tract_broadband"</span>,</span>
<span>  username <span class="op">=</span> <span class="st">"kwalkertcu"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If the upload has succeeded, you’ll get a message like this:</p>
<pre><code>✔ Successfully created tileset source with the ID
'mapbox://tileset-source/kwalkertcu/tract_broadband'.
Use your source ID to build your tileset's recipe.</code></pre>
<p>The tileset ID is also stored in the <code>id</code> element of the
returned list. If your request has failed, you should get an error
message telling you why.</p>
<p>You’ll now use these tileset IDs to prepare a <em>recipe</em>. MTS
recipes are JSON documents that translate tileset sources to vector
tiles. <a href="https://docs.mapbox.com/mapbox-tiling-service/reference/" class="external-link">Preparing
a recipe using the MTS documentation can be complicated</a> as there are
many options, but mapboxapi tries to simplify this process a bit:</p>
<ul>
<li>
<code><a href="../reference/mts_make_recipe.html">mts_make_recipe()</a></code> is the general “recipe creation”
function that takes one or more <em>recipe layers</em> and formats their
configuration appropriately for the MTS API.</li>
<li>Recipe layers can be prepared as an R list by hand, or preferably
with the <code><a href="../reference/recipe_layer.html">recipe_layer()</a></code> function which helps users
understand the range of options available. Feature- and tile- specific
options are available in <code><a href="../reference/feature_options.html">feature_options()</a></code> and
<code><a href="../reference/tile_options.html">tile_options()</a></code>, respectively.<br>
</li>
<li>Some translation of the JSON examples provided by Mapbox and R’s
notation will be necessary. When reading through the MTS documentation,
remember the following:
<ul>
<li>A <em>named list</em> will be translated to a JSON object (curly
braces);</li>
<li>An <em>unnamed list</em> will be translated to a JSON array (square
brackets).</li>
</ul>
</li>
</ul>
<p>Our recipe will include two layers (counties and tracts). A recipe
layer requires a tileset source ID, a minimum zoom level
(<code>minzoom</code>), and maximum zoom level
(<code>maxzoom</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">broadband_recipe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mts_make_recipe.html">mts_make_recipe</a></span><span class="op">(</span></span>
<span>  counties <span class="op">=</span> <span class="fu"><a href="../reference/recipe_layer.html">recipe_layer</a></span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="va">county_source</span><span class="op">$</span><span class="va">id</span>,</span>
<span>    minzoom <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    maxzoom <span class="op">=</span> <span class="fl">7</span></span>
<span>  <span class="op">)</span>,</span>
<span>  tracts <span class="op">=</span> <span class="fu"><a href="../reference/recipe_layer.html">recipe_layer</a></span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="va">tract_source</span><span class="op">$</span><span class="va">id</span>,</span>
<span>    minzoom <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    maxzoom <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    tiles <span class="op">=</span> <span class="fu"><a href="../reference/tile_options.html">tile_options</a></span><span class="op">(</span></span>
<span>      layer_size <span class="op">=</span> <span class="fl">2500</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Our recipe is relatively simple, as MTS recipes are concerned; we
include the required arguments (though layers can be viewed beyond the
maximum zoom level with overzooming) as well as directions to max out
the layer size for our tracts, ensuring that we can see as many tracts
as possible when zoomed out.</p>
<p>After preparing an MTS recipe, it can be passed to the
<code><a href="../reference/mts_validate_recipe.html">mts_validate_recipe()</a></code> function to make sure that it is
formatted correctly.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mts_validate_recipe.html">mts_validate_recipe</a></span><span class="op">(</span><span class="va">broadband_recipe</span><span class="op">)</span></span></code></pre></div>
<p>We get the message <code>✔ Your tileset recipe is valid!</code>; the
function also returns <code>TRUE</code> or <code>FALSE</code> so you can
do error handling in tileset creation pipelines if you wish.</p>
<p>Just two more steps are required to publish the new tileset. We
create the tileset with <code><a href="../reference/mts_create_tileset.html">mts_create_tileset()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mts_create_tileset.html">mts_create_tileset</a></span><span class="op">(</span></span>
<span>  tileset_name <span class="op">=</span> <span class="st">"us_broadband"</span>,</span>
<span>  username <span class="op">=</span> <span class="st">"kwalkertcu"</span>,</span>
<span>  recipe <span class="op">=</span> <span class="va">broadband_recipe</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>An empty tileset will be created in our Mapbox account. To populate
the tileset, publish it with <code><a href="../reference/mts_publish_tileset.html">mts_publish_tileset()</a></code></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mts_publish_tileset.html">mts_publish_tileset</a></span><span class="op">(</span></span>
<span>  tileset_name <span class="op">=</span> <span class="st">"us_broadband"</span>,</span>
<span>  username <span class="op">=</span> <span class="st">"kwalkertcu"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To check on the status of your tileset, you can head over to your
Mapbox account and find your tileset on the <strong>Tilesets</strong>
tab. Once the tileset is published, you’ll be able to browse your
tileset and review its recipe.</p>
<p><img src="img/example_tileset.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="using-vector-tilesets-in-r-with-the-mapgl-package">Using vector tilesets in R with the mapgl package<a class="anchor" aria-label="anchor" href="#using-vector-tilesets-in-r-with-the-mapgl-package"></a>
</h2>
<p>The <a href="https://walker-data.com/mapgl" class="external-link">mapgl R package</a> is a
a flexible R interface to <a href="https://docs.mapbox.com/mapbox-gl-js/api/" class="external-link">Mapbox GL JS</a>,
Mapbox’s JavaScript web mapping library with a massive amount of
features. mapboxapi and mapgl work quite nicely together; mapboxapi can
handle the creation and maintenance of vector tileset pipelines, and
mapgl then handles the visualization of those tiles.</p>
<p>The <code><a href="https://walker-data.com/mapgl/reference/add_vector_source.html" class="external-link">add_vector_source()</a></code> function in mapgl allows users
to load remote vector tile sources from their Mapbox account; the
<code><a href="https://walker-data.com/mapgl/reference/add_fill_layer.html" class="external-link">add_fill_layer()</a></code> function then helps users add layers from
those tileset sources. Given that we’ve already tiled our county and
tract data, we can visualize all 3000+ US counties and all 80,000+
Census tracts intelligently on the same map.</p>
<p>The code used below (click “Show code” to view it) uses mapgl to
visualize counties and Census tracts in a scale-dependent manner. At
small zooms (below 7), counties will display; at larger zooms (7 and
up), the view will switch over to Census tracts.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/mapgl/" class="external-link">mapgl</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://walker-data.com/mapgl/reference/mapboxgl.html" class="external-link">mapboxgl</a></span><span class="op">(</span>style <span class="op">=</span> <span class="fu"><a href="https://walker-data.com/mapgl/reference/mapbox_style.html" class="external-link">mapbox_style</a></span><span class="op">(</span><span class="st">"light"</span><span class="op">)</span>,</span>
<span>         zoom <span class="op">=</span> <span class="fl">3</span>,</span>
<span>         center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">96</span>, <span class="fl">37.5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://walker-data.com/mapgl/reference/add_vector_source.html" class="external-link">add_vector_source</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"broadband"</span>,</span>
<span>    url <span class="op">=</span> <span class="st">"mapbox://kwalkertcu.us_broadband"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://walker-data.com/mapgl/reference/add_fill_layer.html" class="external-link">add_fill_layer</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>    source <span class="op">=</span> <span class="st">"broadband"</span>,</span>
<span>    source_layer <span class="op">=</span> <span class="st">"counties"</span>,</span>
<span>    fill_color <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    fill_outline_color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    fill_opacity <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    max_zoom <span class="op">=</span> <span class="fl">7</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://walker-data.com/mapgl/reference/add_fill_layer.html" class="external-link">add_fill_layer</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"tracts"</span>,</span>
<span>    source <span class="op">=</span> <span class="st">"broadband"</span>,</span>
<span>    source_layer <span class="op">=</span> <span class="st">"tracts"</span>,</span>
<span>    fill_color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    fill_outline_color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    fill_opacity <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    min_zoom <span class="op">=</span> <span class="fl">7</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:432.632880098888px;" class="mapboxgl html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"style":"mapbox://styles/mapbox/light-v11","center":[-96,37.5],"zoom":3,"bearing":0,"pitch":0,"projection":"globe","parallels":null,"access_token":"pk.eyJ1Ijoia3dhbGtlcnRjdSIsImEiOiJMRk9JSmRvIn0.l1y2jHZ6IARHM_rA1-X45A","additional_params":[],"sources":[{"id":"broadband","type":"vector","url":"mapbox://kwalkertcu.us_broadband"}],"layers":[{"id":"county","type":"fill","source":"broadband","source_layer":"counties","paint":{"fill-antialias":true,"fill-color":"blue","fill-opacity":0.5,"fill-outline-color":"black","fill-translate-anchor":"map"},"layout":{"visibility":"visible"},"slot":null,"minzoom":null,"maxzoom":7,"popup":null,"tooltip":null,"hover_options":null,"before_id":null,"filter":null},{"id":"tracts","type":"fill","source":"broadband","source_layer":"tracts","paint":{"fill-antialias":true,"fill-color":"red","fill-opacity":0.5,"fill-outline-color":"black","fill-translate-anchor":"map"},"layout":{"visibility":"visible"},"slot":null,"minzoom":7,"maxzoom":null,"popup":null,"tooltip":null,"hover_options":null,"before_id":null,"filter":null}]},"evals":[],"jsHooks":[]}</script><div class="section level3">
<h3 id="styling-vector-tiles-with-mapbox-gl-js-and-mapboxer">Styling vector tiles with Mapbox GL JS and mapboxer<a class="anchor" aria-label="anchor" href="#styling-vector-tiles-with-mapbox-gl-js-and-mapboxer"></a>
</h3>
<p>Mapbox GL JS has many, many more options available for users to
customize styling of their vector tiles. <a href="https://docs.mapbox.com/mapbox-gl-js/style-spec/" class="external-link">While those
options are voluminous</a>, mapgl includes a variety of helper functions
to assist with styling.</p>
<p>The example below modifies the map using the following options:</p>
<ul>
<li>An Albers projection appropriate for the United States is used
instead of the default Globe projection.<br>
</li>
<li>Counties and Census tracts are styled using linear interpolation
with the <code>interpolate()</code> function inspired by the ColorBrewer
YlGnBU palette.</li>
<li>For Census tracts, the <code>"case"</code> option is used for
<code>NA</code> values to make tracts missing data mostly
transparent.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">broadband_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/mapgl/reference/mapboxgl.html" class="external-link">mapboxgl</a></span><span class="op">(</span>style <span class="op">=</span> <span class="fu"><a href="https://walker-data.com/mapgl/reference/mapbox_style.html" class="external-link">mapbox_style</a></span><span class="op">(</span><span class="st">"light"</span><span class="op">)</span>,</span>
<span>         zoom <span class="op">=</span> <span class="fl">3</span>,</span>
<span>         center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">96</span>, <span class="fl">37.5</span><span class="op">)</span>,</span>
<span>         projection <span class="op">=</span> <span class="st">"albers"</span>,</span>
<span>         parallels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">29.5</span>, <span class="fl">45.5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://walker-data.com/mapgl/reference/add_vector_source.html" class="external-link">add_vector_source</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"broadband"</span>,</span>
<span>    url <span class="op">=</span> <span class="st">"mapbox://kwalkertcu.us_broadband"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://walker-data.com/mapgl/reference/add_fill_layer.html" class="external-link">add_fill_layer</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>    source <span class="op">=</span> <span class="st">"broadband"</span>,</span>
<span>    source_layer <span class="op">=</span> <span class="st">"counties"</span>,</span>
<span>    fill_color <span class="op">=</span> <span class="fu">interpolate</span><span class="op">(</span></span>
<span>      column <span class="op">=</span> <span class="st">"estimate"</span>,</span>
<span>      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">33</span>, <span class="fl">65</span>, <span class="fl">97</span><span class="op">)</span>,</span>
<span>      stops <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#edf8b1"</span>, <span class="st">"#7fcdbb"</span>, <span class="st">"#2c7fb8"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill_opacity <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    max_zoom <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    popup <span class="op">=</span> <span class="st">"estimate"</span>,</span>
<span>    hover_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      fill_color <span class="op">=</span> <span class="st">"cyan"</span>,</span>
<span>      fill_opacity <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://walker-data.com/mapgl/reference/add_fill_layer.html" class="external-link">add_fill_layer</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="st">"tracts"</span>,</span>
<span>    source <span class="op">=</span> <span class="st">"broadband"</span>,</span>
<span>    source_layer <span class="op">=</span> <span class="st">"tracts"</span>,</span>
<span>    fill_color <span class="op">=</span> <span class="fu">interpolate</span><span class="op">(</span></span>
<span>      column <span class="op">=</span> <span class="st">"estimate"</span>,</span>
<span>      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">33</span>, <span class="fl">65</span>, <span class="fl">97</span><span class="op">)</span>,</span>
<span>      stops <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#edf8b1"</span>, <span class="st">"#7fcdbb"</span>, <span class="st">"#2c7fb8"</span><span class="op">)</span>,</span>
<span>      na_color <span class="op">=</span> <span class="st">"white"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill_opacity <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    min_zoom <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    popup <span class="op">=</span> <span class="st">"estimate"</span>,</span>
<span>    hover_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      fill_color <span class="op">=</span> <span class="st">"cyan"</span>,</span>
<span>      fill_opacity <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">broadband_map</span></span></code></pre></div>
<div id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:432.632880098888px;" class="mapboxgl html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"style":"mapbox://styles/mapbox/light-v11","center":[-96,37.5],"zoom":3,"bearing":0,"pitch":0,"projection":"albers","parallels":[29.5,45.5],"access_token":"pk.eyJ1Ijoia3dhbGtlcnRjdSIsImEiOiJMRk9JSmRvIn0.l1y2jHZ6IARHM_rA1-X45A","additional_params":[],"sources":[{"id":"broadband","type":"vector","url":"mapbox://kwalkertcu.us_broadband"}],"layers":[{"id":"county","type":"fill","source":"broadband","source_layer":"counties","paint":{"fill-antialias":true,"fill-color":["interpolate",["linear"],["get","estimate"],33,"#edf8b1",65,"#7fcdbb",97,"#2c7fb8"],"fill-opacity":0.5,"fill-translate-anchor":"map"},"layout":{"visibility":"visible"},"slot":null,"minzoom":null,"maxzoom":7,"popup":"estimate","tooltip":null,"hover_options":{"fill_color":"cyan","fill_opacity":1},"before_id":null,"filter":null},{"id":"tracts","type":"fill","source":"broadband","source_layer":"tracts","paint":{"fill-antialias":true,"fill-color":["case",["==",["get","estimate"],null],"white",["interpolate",["linear"],["get","estimate"],33,"#edf8b1",65,"#7fcdbb",97,"#2c7fb8"]],"fill-opacity":0.5,"fill-translate-anchor":"map"},"layout":{"visibility":"visible"},"slot":null,"minzoom":7,"maxzoom":null,"popup":"estimate","tooltip":null,"hover_options":{"fill_color":"cyan","fill_opacity":1},"before_id":null,"filter":null}]},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="adding-a-custom-built-legend">Adding a custom-built legend<a class="anchor" aria-label="anchor" href="#adding-a-custom-built-legend"></a>
</h3>
<p>While the map data are styled in relationship to locations’ broadband
access, we’ll also want to add a legend to our map to communicate the
information to our viewers more clearly. The <code>add_legend()</code>
function in mapgl accommodates both continuous legends (the default,
which we’ll use here) along with categorical legends.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">broadband_map</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">add_legend</span><span class="op">(</span></span>
<span>    <span class="st">"Households with broadband access"</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"33%"</span>, <span class="st">"65%"</span>, <span class="st">"97%"</span><span class="op">)</span>,</span>
<span>    colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#edf8b1"</span>, <span class="st">"#7fcdbb"</span>, <span class="st">"#2c7fb8"</span><span class="op">)</span>, </span>
<span>    position <span class="op">=</span> <span class="st">"bottom-left"</span>, </span>
<span>    width <span class="op">=</span> <span class="st">"150px"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-36aa3d2a04d42bbc2145" style="width:100%;height:432.632880098888px;" class="mapboxgl html-widget"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"style":"mapbox://styles/mapbox/light-v11","center":[-96,37.5],"zoom":3,"bearing":0,"pitch":0,"projection":"albers","parallels":[29.5,45.5],"access_token":"pk.eyJ1Ijoia3dhbGtlcnRjdSIsImEiOiJMRk9JSmRvIn0.l1y2jHZ6IARHM_rA1-X45A","additional_params":[],"sources":[{"id":"broadband","type":"vector","url":"mapbox://kwalkertcu.us_broadband"}],"layers":[{"id":"county","type":"fill","source":"broadband","source_layer":"counties","paint":{"fill-antialias":true,"fill-color":["interpolate",["linear"],["get","estimate"],33,"#edf8b1",65,"#7fcdbb",97,"#2c7fb8"],"fill-opacity":0.5,"fill-translate-anchor":"map"},"layout":{"visibility":"visible"},"slot":null,"minzoom":null,"maxzoom":7,"popup":"estimate","tooltip":null,"hover_options":{"fill_color":"cyan","fill_opacity":1},"before_id":null,"filter":null},{"id":"tracts","type":"fill","source":"broadband","source_layer":"tracts","paint":{"fill-antialias":true,"fill-color":["case",["==",["get","estimate"],null],"white",["interpolate",["linear"],["get","estimate"],33,"#edf8b1",65,"#7fcdbb",97,"#2c7fb8"]],"fill-opacity":0.5,"fill-translate-anchor":"map"},"layout":{"visibility":"visible"},"slot":null,"minzoom":7,"maxzoom":null,"popup":"estimate","tooltip":null,"hover_options":{"fill_color":"cyan","fill_opacity":1},"before_id":null,"filter":null}],"legend_html":"<div id=\"legend-cd597\" class=\"mapboxgl-legend bottom-left\"><h2>Households with broadband access<\/h2><div class=\"legend-gradient\" style=\"background:linear-gradient(to right, #edf8b1, #7fcdbb, #2c7fb8)\"><\/div><div class=\"legend-labels\" style=\"position: relative; height: 20px;\"><span style=\"position: absolute; left: 0%; transform: translateX(-50%);\">33%<\/span><span style=\"position: absolute; left: 50%; transform: translateX(-50%);\">65%<\/span><span style=\"position: absolute; left: 100%; transform: translateX(-50%);\">97%<\/span><\/div><\/div>","legend_css":"\n    @import url('https://fonts.googleapis.com/css2?family=Open+Sans&display=swap');\n\n    #legend-cd597 h2 {\n      font-size: 14px;\n      font-family: 'Open Sans';\n      line-height: 20px;\n      margin-bottom: 10px;\n      margin-top: 0px;\n    }\n\n    #legend-cd597 {\n      position: absolute;\n      border-radius: 10px;\n      margin: 10px;\n      width: 150px;\n      background-color: #ffffff80;\n      padding: 10px 20px;\n      z-index: 1002;\n    }\n\n    #legend-cd597.top-left {\n      top: 10px;\n      left: 10px;\n    }\n\n    #legend-cd597.bottom-left {\n      bottom: 10px;\n      left: 10px;\n    }\n\n    #legend-cd597.top-right {\n      top: 10px;\n      right: 10px;\n    }\n\n    #legend-cd597.bottom-right {\n      bottom: 10px;\n      right: 10px;\n    }\n\n    #legend-cd597 .legend-gradient {\n      height: 20px;\n      margin-bottom: 5px;\n    }\n\n    #legend-cd597 .legend-labels {\n      display: flex;\n      justify-content: space-between;\n      font-family: 'Open Sans';\n    }\n\n    #legend-cd597 .legend-labels span {\n      position: absolute;\n      transform: translateX(-50%);\n    }\n"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://walker-data.com" class="external-link">Kyle Walker</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
